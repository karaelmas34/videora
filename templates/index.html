<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Videora â€“ YouTube Video Ä°ndir</title>
    <link rel="stylesheet" href="/static/styles.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            padding: 40px;
            text-align: center;
        }
        h1 {
            color: #2b6cb0;
        }
        form {
            background-color: #fff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            display: inline-block;
            margin-bottom: 20px;
        }
        input, select, button {
            padding: 10px;
            margin: 10px;
            width: 300px;
            font-size: 16px;
        }
        button {
            background-color: #2b6cb0;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        button:hover {
            background-color: #225ea8;
        }
        #progressBox {
            display: none;
            margin-top: 30px;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            display: inline-block;
        }
        #progressBox p {
            font-size: 18px;
            margin: 10px 0;
        }
    </style>
</head>
<body>

    <h1>ðŸŽ¬ Videora</h1>
    <p>YouTube videolarÄ±nÄ± doÄŸrudan indir</p>

    <form id="downloadForm">
        <input type="text" name="url" placeholder="YouTube video linkini girin" required><br>
        <select name="format" required>
            <option value="mp4">MP4 (Video)</option>
            <option value="mp3">MP3 (Ses)</option>
        </select><br>
        <select name="resolution" required>
            <option value="360">360p</option>
            <option value="480">480p</option>
            <option value="720">720p</option>
            <option value="1080">1080p</option>
        </select><br>
        <button type="submit">Ä°ndir</button>
    </form>

    <div id="progressBox">
        <h3>Ä°ndirme Ä°lerlemesi</h3>
        <p>% YÃ¼kleniyor: <span id="percent">0</span></p>
        <p>Ä°ndirme HÄ±zÄ±: <span id="speed">0</span> MB/s</p>
        <p>Kalan SÃ¼re: <span id="eta">0</span> saniye</p>
    </div>

    <script>
        let progressInterval;
        let userId = '';

        function startTrackingProgress(id) {
            userId = id;
            document.getElementById('progressBox').style.display = 'block';

            progressInterval = setInterval(() => {
                fetch(`/progress/${userId}`)
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('percent').textContent = data.percent.toFixed(1);
                        document.getElementById('speed').textContent = data.speed.toFixed(2);
                        document.getElementById('eta').textContent = data.eta.toFixed(0);
                    });
            }, 1500);
        }

        document.getElementById('downloadForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const formData = new FormData(this);

            const fakeUserId = Math.random().toString(36).substring(2, 10); // gerÃ§ek UUID entegrasyonu gerekebilir
            startTrackingProgress(fakeUserId);

            fetch('/download', {
                method: 'POST',
                body: formData
            })
            .then(res => res.blob())
            .then(blob => {
                clearInterval(progressInterval);
                document.getElementById('progressBox').style.display = 'none';
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = "video." + formData.get("format");
                a.click();
            })
            .catch(err => {
                clearInterval(progressInterval);
                document.getElementById('progressBox').style.display = 'none';
                alert("Ä°ndirme sÄ±rasÄ±nda hata oluÅŸtu: " + err);
            });
        });
    </script>

</body>
</html>
